<!DOCTYPE html>
<html lang="ru" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Расходы</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Расходы" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <meta name="theme-color" content="#e6f0e6" />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      background-color: #f9f7f1;
      color: #2a4d2a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 15px;
      -webkit-font-smoothing: antialiased;
    }
    h1 { color: #2a7f2a; font-weight:700; margin: 0 0 12px; font-size: 1.6rem; text-align:center; }
    form {
      background: #e6f0e6;
      padding: 18px 20px;
      border-radius: 14px;
      box-shadow: 0 4px 15px rgba(58,100,58,0.12);
      max-width: 420px;
      width: 100%;
      transition: box-shadow .25s;
    }
    form:focus-within { box-shadow: 0 6px 20px rgba(58,100,58,0.2); }
    label { display:block; margin-top:10px; font-weight:600; color:#206520; }
    input[type="date"], input[type="number"], input[type="text"]{
      width:100%; padding:12px 14px; margin-top:6px;
      border:2px solid #7fb87f; border-radius:10px; font-size:1rem;
      color:#1f3d1f;
    }
    input:focus { border-color:#3c783c; outline:none; }
    .buttons { display:flex; gap:10px; margin-top:18px; }
    .btn {
      flex:1; padding:12px 10px; font-weight:700; border-radius:12px;
      border:none; cursor:pointer; font-size:1rem; user-select:none;
      box-shadow:0 4px 10px rgba(0,0,0,0.08);
    }
    .btn-add { background:#4caf50; color:#fff; box-shadow:0 6px 14px rgba(76,175,80,0.25); }
    .btn-add:active { transform:translateY(1px); }
    .btn-clear { background:#b44242; color:#fff; }
    .summary {
      margin-top:18px; max-width:420px; width:100%;
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 16px; border-radius:12px; background:#f0f6f0; box-shadow:0 2px 8px rgba(31,61,31,0.06);
      color:#174a18; font-weight:700;
    }
    ul { max-width:420px; width:100%; margin:16px auto 40px; padding:0; list-style:none; }
    li {
      background:#d6ead6; margin-bottom:10px; padding:12px 12px; border-radius:14px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      box-shadow:0 2px 6px rgba(31,61,31,0.12);
    }
    .expense-info { flex:1; min-width:0; }
    .expense-info .desc { display:block; font-size:1rem; color:#113811; font-weight:600; }
    .expense-info .meta { display:block; font-size:0.85rem; color:#2a4d2a; opacity:0.85; margin-top:3px; }
    .amount { white-space:nowrap; font-weight:800; margin-left:8px; font-size:1rem; color:#06390a; }
    /* 작은 иконка-удалить */
    .icon-btn {
      width:36px; height:36px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center;
      border:none; background:transparent; cursor:pointer; padding:0;
    }
    .icon-btn svg { width:18px; height:18px; display:block; opacity:0.9; }
    .icon-btn:hover svg { opacity:1; transform:scale(1.05); }
    .icon-btn:active { transform:translateY(1px); }
    @media (max-width:450px){
      body{ padding:14px 10px; }
      h1{ font-size:1.3rem; }
      .buttons{ flex-direction:column; }
      .btn{ width:100%; }
      .icon-btn{ width:34px; height:34px; }
    }
  </style>
</head>
<body>
  <h1>Мои расходы</h1>

  <form id="expenseForm" autocomplete="off" novalidate>
    <label for="date">Дата</label>
    <input type="date" id="date" required />

    <label for="amount">Сумма</label>
    <input type="number" id="amount" min="0.01" step="0.01" placeholder="0.00" required />

    <label for="description">Назначение</label>
    <input type="text" id="description" placeholder="Описание расхода" maxlength="100" required />

    <div class="buttons">
      <button type="submit" class="btn btn-add">Добавить расход</button>
      <button type="button" id="clearAllSmall" class="btn btn-clear">Очистить все</button>
    </div>
  </form>

  <div id="summary" class="summary" aria-live="polite">
    <span>Общая сумма:</span>
    <span id="totalAmount">0,00 ₽</span>
  </div>

  <ul id="expenseList" aria-live="polite"></ul>

<script>
  const form = document.getElementById('expenseForm');
  const expenseList = document.getElementById('expenseList');
  const clearAllBtn = document.getElementById('clearAllSmall');
  const totalAmountEl = document.getElementById('totalAmount');

  // Загружаем
  let expenses = JSON.parse(localStorage.getItem('expenses')) || [];

  const ruFormatter = new Intl.NumberFormat('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  function saveExpenses() {
    localStorage.setItem('expenses', JSON.stringify(expenses));
  }

  function formatDateDDMMYYYY(dateStr) {
    // Ожидаем ISO yyyy-mm-dd или Date совместимый
    if (!dateStr) return '';
    const d = new Date(dateStr);
    if (isNaN(d)) return dateStr;
    const dd = String(d.getDate()).padStart(2, '0');
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const yyyy = d.getFullYear();
    return `${dd}.${mm}.${yyyy}`;
  }

  function formatAmount(num) {
    const n = Number(num);
    if (isNaN(n)) return num;
    return ruFormatter.format(n) + ' ₽';
  }

  function calculateTotal() {
    return expenses.reduce((s, e) => s + (Number(e.amount) || 0), 0);
  }

  function renderExpenses() {
    expenseList.innerHTML = '';
    if (!expenses || expenses.length === 0) {
      const liEmpty = document.createElement('li');
      liEmpty.style.textAlign = 'center';
      liEmpty.style.color = '#5a5a5a';
      liEmpty.textContent = 'Список расходов пуст';
      expenseList.appendChild(liEmpty);
      totalAmountEl.textContent = formatAmount(0);
      return;
    }

    expenses.forEach((expense, index) => {
      const li = document.createElement('li');

      const info = document.createElement('div');
      info.className = 'expense-info';
      const desc = document.createElement('span');
      desc.className = 'desc';
      desc.textContent = expense.description;
      const meta = document.createElement('span');
      meta.className = 'meta';
      meta.textContent = formatDateDDMMYYYY(expense.date);

      info.appendChild(desc);
      info.appendChild(meta);

      const right = document.createElement('div');
      right.style.display = 'flex';
      right.style.alignItems = 'center';
      right.style.gap = '8px';

      const amountEl = document.createElement('div');
      amountEl.className = 'amount';
      amountEl.textContent = formatAmount(expense.amount);

      const delBtn = document.createElement('button');
      delBtn.className = 'icon-btn';
      delBtn.setAttribute('aria-label', `Удалить расход ${formatDateDDMMYYYY(expense.date)} ${formatAmount(expense.amount)}`);
      delBtn.title = 'Удалить';
      // SVG корзины (маленькая)
      delBtn.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M3 6h18" stroke="#b44242" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 6l1-2h6l1 2" stroke="#b44242" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 11v6" stroke="#b44242" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 11v6" stroke="#b44242" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 6l1 15h12l1-15" stroke="#b44242" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      `;
      delBtn.addEventListener('click', () => {
        expenses.splice(index, 1);
        saveExpenses();
        renderExpenses();
      });

      right.appendChild(amountEl);
      right.appendChild(delBtn);

      li.appendChild(info);
      li.appendChild(right);
      expenseList.appendChild(li);
    });

    const total = calculateTotal();
    totalAmountEl.textContent = formatAmount(total);
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const date = form.date.value; // yyyy-mm-dd from input[type=date]
    const amountRaw = form.amount.value;
    const description = form.description.value.trim();

    if (!date) { alert('Пожалуйста, укажите дату.'); return; }
    if (!amountRaw || isNaN(amountRaw) || Number(amountRaw) <= 0) { alert('Введите корректную сумму.'); return; }
    if (!description) { alert('Введите назначение расхода.'); return; }

    const amount = Number(amountRaw).toFixed(2);

    expenses.push({ date, amount, description });
    saveExpenses();
    renderExpenses();

    form.reset();
    form.date.focus();
  });

  clearAllBtn.addEventListener('click', () => {
    if (!expenses || expenses.length === 0) { alert('Список уже пуст.'); return; }
    if (confirm('Вы уверены, что хотите удалить все расходы?')) {
      expenses = [];
      saveExpenses();
      renderExpenses();
    }
  });

  // Рендер при загрузке
  renderExpenses();
</script>
</body>
</html>
